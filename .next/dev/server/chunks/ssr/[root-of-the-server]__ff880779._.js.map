{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///D:/6th%20Semester/Code/Next/personal-finance-system/lib/auth-context.tsx"],"sourcesContent":["\"use client\"\n\nimport type React from \"react\"\nimport { createContext, useContext, useEffect, useState } from \"react\"\nimport type { User, AuthContextType } from \"./types\"\n\nexport const AuthContext = createContext<AuthContextType | undefined>(undefined)\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUser] = useState<User | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    const checkAuth = async () => {\n      try {\n        const response = await fetch(\"/api/auth/me\")\n        if (response.ok) {\n          const data = await response.json()\n          // Map API response to User type\n          setUser({\n            userId: data.user.id,\n            username: data.user.username,\n            email: data.user.email,\n            roleId: data.user.roleId,\n            roleName: data.user.roleName,\n            currency: data.user.currency,\n            password: \"\", // Not needed on client side\n          })\n        }\n      } catch (error) {\n        console.error(\"[v0] Auth check failed:\", error)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    checkAuth()\n  }, [])\n\n  const login = async (email: string, password: string) => {\n    try {\n      console.log(\"[v0] Attempting login...\")\n      const response = await fetch(\"/api/auth/login\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, password }),\n      })\n\n      const contentType = response.headers.get(\"content-type\")\n      if (!contentType || !contentType.includes(\"application/json\")) {\n        console.error(\"[v0] Received non-JSON response from API\")\n        throw new Error(\"Server error. Please make sure the database is seeded and MongoDB is connected.\")\n      }\n\n      const data = await response.json()\n\n      if (!response.ok) {\n        throw new Error(data.error || \"Login failed\")\n      }\n\n      setUser({\n        userId: data.user.id,\n        username: data.user.username,\n        email: data.user.email,\n        roleId: data.user.roleId,\n        roleName: data.user.roleName,\n        currency: data.user.currency,\n        password: \"\",\n      })\n    } catch (error) {\n      console.error(\"[v0] Login error:\", error)\n      throw error\n    }\n  }\n\n  const logout = async () => {\n    try {\n      await fetch(\"/api/auth/logout\", { method: \"POST\" })\n    } catch (error) {\n      console.error(\"[v0] Logout error:\", error)\n    }\n    setUser(null)\n  }\n\n  if (loading) {\n    return <div className=\"min-h-screen flex items-center justify-center\">Loading...</div>\n  }\n\n  return <AuthContext.Provider value={{ user, login, logout }}>{children}</AuthContext.Provider>\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext)\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\")\n  }\n  return context\n}\n"],"names":[],"mappings":";;;;;;;;;AAGA;AAHA;;;AAMO,MAAM,4BAAc,IAAA,uPAAa,EAA8B;AAE/D,SAAS,aAAa,EAAE,QAAQ,EAAiC;IACtE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,kPAAQ,EAAc;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,kPAAQ,EAAC;IAEvC,IAAA,mPAAS,EAAC;QACR,MAAM,YAAY;YAChB,IAAI;gBACF,MAAM,WAAW,MAAM,MAAM;gBAC7B,IAAI,SAAS,EAAE,EAAE;oBACf,MAAM,OAAO,MAAM,SAAS,IAAI;oBAChC,gCAAgC;oBAChC,QAAQ;wBACN,QAAQ,KAAK,IAAI,CAAC,EAAE;wBACpB,UAAU,KAAK,IAAI,CAAC,QAAQ;wBAC5B,OAAO,KAAK,IAAI,CAAC,KAAK;wBACtB,QAAQ,KAAK,IAAI,CAAC,MAAM;wBACxB,UAAU,KAAK,IAAI,CAAC,QAAQ;wBAC5B,UAAU,KAAK,IAAI,CAAC,QAAQ;wBAC5B,UAAU;oBACZ;gBACF;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,2BAA2B;YAC3C,SAAU;gBACR,WAAW;YACb;QACF;QAEA;IACF,GAAG,EAAE;IAEL,MAAM,QAAQ,OAAO,OAAe;QAClC,IAAI;YACF,QAAQ,GAAG,CAAC;YACZ,MAAM,WAAW,MAAM,MAAM,mBAAmB;gBAC9C,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE;oBAAO;gBAAS;YACzC;YAEA,MAAM,cAAc,SAAS,OAAO,CAAC,GAAG,CAAC;YACzC,IAAI,CAAC,eAAe,CAAC,YAAY,QAAQ,CAAC,qBAAqB;gBAC7D,QAAQ,KAAK,CAAC;gBACd,MAAM,IAAI,MAAM;YAClB;YAEA,MAAM,OAAO,MAAM,SAAS,IAAI;YAEhC,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,IAAI,MAAM,KAAK,KAAK,IAAI;YAChC;YAEA,QAAQ;gBACN,QAAQ,KAAK,IAAI,CAAC,EAAE;gBACpB,UAAU,KAAK,IAAI,CAAC,QAAQ;gBAC5B,OAAO,KAAK,IAAI,CAAC,KAAK;gBACtB,QAAQ,KAAK,IAAI,CAAC,MAAM;gBACxB,UAAU,KAAK,IAAI,CAAC,QAAQ;gBAC5B,UAAU,KAAK,IAAI,CAAC,QAAQ;gBAC5B,UAAU;YACZ;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,qBAAqB;YACnC,MAAM;QACR;IACF;IAEA,MAAM,SAAS;QACb,IAAI;YACF,MAAM,MAAM,oBAAoB;gBAAE,QAAQ;YAAO;QACnD,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,sBAAsB;QACtC;QACA,QAAQ;IACV;IAEA,IAAI,SAAS;QACX,qBAAO,+QAAC;YAAI,WAAU;sBAAgD;;;;;;IACxE;IAEA,qBAAO,+QAAC,YAAY,QAAQ;QAAC,OAAO;YAAE;YAAM;YAAO;QAAO;kBAAI;;;;;;AAChE;AAEO,SAAS;IACd,MAAM,UAAU,IAAA,oPAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT"}}]
}